using System;
using System.Buffers.Text;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Net.NetworkInformation;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;
namespace SearchInFlows
{ 
// Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class
// To generate Base64 string for Images below, you can use https://www.base64-image.de/
    [Export(typeof(IXrmToolBoxPlugin)),
        ExportMetadata("Name", "Search in flows"),
        ExportMetadata("Description", "This plugin allows you to perform text searches within all flows in a solution and view the path to the box where the text is located. It's especially useful when searching for parameters, conditions, etc. in large flows that we haven't developed yet.\r\n"),
        // Please specify the base64 content of a 32x32 pixels image
        ExportMetadata("SmallImageBase64", "iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC / xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB / lBMVEX////+/v7+///+//77/v77/f78/v7//v/9///9/v/0/PyS2ONxydqv3ur9/v5SwNN6z9265u1et9OOxt75+vu0ubzb3d/19vb39/fy8/P29vfu7+/u7/DMz9Ht7+/6+vvj5ebt7u/7+/u24ut8zd3p8vhxs9b0+Ptipc/t9fr8+/qqsbaqsLSQmJ2wtrmVnaKepamlq6+5vsKhp6uorbHs7u+jqa2do6jR1Nb7+/z9/f5swtiPzt/X7PPK5e6AstXF2et8p9Pd6PTMzc/My8zHyMnR0dHDwcHS09Pg4N/R0c/c3d7Z293x8vLMz9Da3Nzj5Ob+/v/x+fsQjr1frtGs0eTR4++SsNh0mc7K6vPH6vTS7PTV6vWs1O2nzenH3fGuy+jO3e7T4PDP2O/k6fbI0OzO0+2vs+DAwOW+u+P5+Pzw9/ozjMA4isGTutrW4O6gt9t6mM9ldMLa2e5Ps9NFqc+AwNuBuduKu9yCs9mErtiTtdxmkctjh8llgcidq9paacKvsN6hodibkdOOfMn+/P31+fs4fbxHfL2wwd+5wt/s7fbEwOSOecjw+vuo2eq02uqp0ueaxOPk7vbL3+/W4vGiu+DM2e3G0urK0eq2v+PJzOvGxObc2e7Vy+q7ptr59vrV4e+1x+Lk6fTl5vL5+fz59/z8/f77/P3//v4B7s09AAAAAWJLR0QAiAUdSAAAAAd0SU1FB+kKFgw2KpngUc8AAAI8elRYdFJhdyBwcm9maWxlIHR5cGUgeG1wAAA4jaVUW7LbIAz9ZxVdApaEBMuxjfnrTD+7/B4JJ05yc297p2HiB0I6D2TS75+/0g//mdbEOw+rlnVR1k2LCWUlLWra9OBOdIxt2wYR5puKzxTjIp2zdMvCWFu1Jam2GhIL2ypHEcUdBZmRRMSDD8q8W+XVqiJRu4PpQtnfddfD2GPJEcBGdDgPXmfgvjyYXGUwtwWnKr1kcj7DaVBOXOiIfwb+RCeUVV4LiYi+IM+Yg1cTjMwrwIZZMvzoMKyiI6obDV64+cBTZsKVcO2zCO5scM/5WqXuAB5OzyxAAU7CJ9IWQhokY8UtDhMIcJDtrKbsyTeFIwWv7R3lwDsuD/EMV7QjcuY4fzcm3ey8fJDJhVmmwYKUyeAF5Fw3LUnuCVQLNnu8LxEeZQw4Ep51vLdXAgk7kdFQAwVQMJ7ydyTestOVflM7se6++QYsgCnFrUd/ie9tm52P0rvDMnYNZNFHHVueg/RSBHONV2Y2XBeU30La6lcHeWdBgo2OGQjeG7oXjg0mkAcJRHZnY0hG538UzaYQ2tKj82486Bb0KIcH0VXk9wcgewCyE4AGGJl/a663qAgWIiVcQJrvSVOW7jE8LZ8Jg9lfCfu7oEtP+j9Bl570r4LedNsq/k3GGpcG2kjxVsOpYpNBhRMojGG+Z3hbpH1aLvoMjM660XTzKI1P4pvdhY92HiQ0ng+0++yHQ9YjPp5P+3Qe9wV2Bxscc3FSpz8e7WoKin18UwAAAAFvck5UAc+id5oAAAGsSURBVDjLY2CgGWBE4TCCCUaQMJiEUCiAiYEJJMwApRhBgImJEdNgRmZGhHlYbATrhChgYmBGdQQjDDBDeEBLEXqZkA1ihBmF5hUmFDuZkfggp7OwsqE6iZGdEaoJZBITB5DBCXE6zJmMTMiGc3Hz8KLZATMJJM/Hxi8gKCTMICIqJi4hKSUtIysnr6CoBA8NNgZlFVU1dQ1NLW0dXT19A0MjYxNTM3MLBksraIhb29ja2Ts4OjE4u7i6uXt4enn7+Pr5B4CNZ2QIZAgKDgkNswyPYGCIjIqOiY2LT0hMSk5JTUvPyMwCSgcyZOfk5uUXFBYVM5SUlpVXVFZV19TW1Tc0NjW3tIIVtLV3dHZ1M/T09vVPmDhp8pSp06bPmDlr9py58+YvAAcSw8JFi5csDQxcxghPGwzsQBwI50G8bMXAxMbGtpzPim/5cisQYAQiSNLhWwFmogIGKImUCpABM7I0sgJQNILSAxNIBRN6OmJkQEQWRnpgZICnRZgCBib06IMmVLCKldjyCjzhMTIwg9mwZA9LG0yw1AZNmBgJBOZniF1MmG7AZSV+AAAH7j/gbbfkBwAADWplWElmSUkqAAgAAAADABIBAwABAAAAAQAAADEBAgAHAAAAMgAAAGmHBAABAAAAOgAAAMgAAABQaWNhc2EAAAYAAJAHAAQAAAAwMjIwAaADAAEAAAABAAAAAqAEAAEAAAAABAAAA6AEAAEAAAAABAAABaAEAAEAAACqAAAAIKQCACEAAACIAAAAAAAAADllNzkxOTExNTk2NzY5MzYwMDAwMDAwMDAwMDAwMDAwAAACAAEAAgAEAAAAUjk4AAIABwAEAAAAMDEwMAAAAAAGAAMBAwABAAAABgAAABoBBQABAAAAFgEAABsBBQABAAAAHgEAACgBAwABAAAAAgAAAAECBAABAAAAJgEAAAICBAABAAAAQwwAAAAAAABIAAAAAQAAAEgAAAABAAAA/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCACgAKADASIAAhEBAxEB/8QAHAABAAIDAQEBAAAAAAAAAAAAAAEFAwQHBgII/8QANxAAAAYCAQMDAwICCQUAAAAAAAECAwQFBhEhBxIxE0FRFCJhcZEVIwgWJDJCUoGSoVOis8Hh/8QAGgEBAAIDAQAAAAAAAAAAAAAAAAEDAgQFBv/EACwRAAICAQMDAgUEAwAAAAAAAAABAhEDBCExEkFRYXEFFCKRoROSscEkMoH/2gAMAwEAAhEDEQA/AP2QJEABBIgAAAAAASIAABICAAAAAAAAAAAAAAAAAAAABIgAAAAAASIMBIA+fAkAAAAAAAAAJAAQAQAAAJAAAEAgAAAAAAAAAAPAAAABsA0AGwDQAAAaAACAA0AAAAAB7AAAEAEAAAAAAAkfDzjbLSnXnENtpLalKPREXyZn4Acbn0A8xI6hYUw+bLmSQCWR6PtWai/ci0L+unwrGKmVAlsSmVeHGXCWn9yFksU4K5RaKMWqwZn045pv0aZsAJAxWXkCQAAQJAOABACQAEAJAAQAn3AAQAAAAkBhmSGYkR6XJcJtlhtTjiz8JSRbM/2BKw2krZlMyIjMzIiHDLKTcdWMyk1EGUuLjkFX3rTySiI9Esy/xKUZH2kfBFyL6B1biZLc/wBXafHp0lcwlttrVJQ0Zp7TM1e/bxs/kXOD10bC3GqkqJ+vZs5Bkh9U1MjbpIMySfBGRdqVa8lv9R1MWOekUpTj9dbcbeXVnm9Xkx/FnCGOd4b+qr3fZXXF87lJIwnpVUWcTHLF5w7SUlPoE7Jc9RezMi/u6SWzI/geZyuguOklqxkmNzHpVS66Tb7Dp/PhC9cGR86VojI/+cnUOkfnwrLLKn6rIpllJQ9XS4DJk3Xtxz9zM+d+OPJlsepzLI4OS/0fpl6pTZ/Uw0kpJGX2vktJGkvySy/YbkJZIuDcnKMn0yT8v+O/2KPkcElPpxrHKK6ouOzpeWue338nQ6CzjXVLDtYajNiWyl1G/JEZeD/JeP8AQeS6sZXZY89Q11bIra5dxLUwuysSNUeKSUd3JEZbUrwkjMi8jF/R79c+lVYb29Gt709/5fVVr/2LLqO1fuNwf4dQV2R1fctNlWSOwnHUmX2KbUv7NpPeyPzvgyHGz41izSguE2j0uCcsmGM3y0jDQXt5T11tMzmZUqqoSEPR7qJ9jUhsyPuJTfco0qSei42StlobdDn2NXH1hNyZENyHHOW83PiuRlkx/wBUiWRbR+S8e45gvptkFlQ5Wiso28WhzziO19KqaSkm6w53rWo0GaWu8iJJEnwZEZ+BaVuM5W+7Z20Ojs622ZqH41dIvL765frOa+1KNqQTf2kfco/OuPIrpFibPbUHUXF7qaqHFkTGnjjqlMlKhOsfUMp8uN96S7yLjx8jWidVMLk0r903YSSrmUtn9QuE6lLi3D0ltv7fvc2WjSnZl7jxFDiWYP5nS3M+ruG2o1bNjyV2dwiU56rjREXahJ9qEGouO3z7kWiG83heTRuk+DR49ey5dY1KjzXa5b6UpfNHcSkEvlJK0rZH42IpC2WeY9UIX9Qra4xuQbNhWSIrcmPYRFtOMJceQna216PRpNRkfjj8D0+L51juR28mprZEkpjDfrelJiOMG41vROI7yLuRv3IeMzaszPNMMu2XsTi1jj70Iocdchtcp1Lb6FuKdWk+wkkRH2p2Z+fkeln0Vm71lq8iRH3WsUsmK473lw4p1Ckp1vfgj/AUidzbuchbrMzKJKtmm4jVM9OdhfSKU4om1lt0nC40RbLs1s9jWoupmI3VtBrYM2Sblg33w3XYbrbMgyT3GlDikklSiLyRH7GQrM6xq6s84kWcKITkVeKzK9K/USW33FEaEaM98/Pgap4ndlQdL4iIJE7RSY67BJOJ/kpTHUhXvz9xkXGwpC2dPAC4EDEyAAAAkUefnrBL8/itkf8AjULwU+axn5mHXUOM2px9+vfbbQXlSjbMiL9xZidZI+6Ks66sUl6M/ImIXcOkt02E2rOyShB+m2UtcdSF8aWSkc78lr8juPSu6l5YuRa1ONwW1QV+klU+6kPqSa089qVJV28cb43yXyOA47bNUdi49Mpa2zV2G2cawbM0oPZc6IyMlFrXPyY7HiVpQTsIduk9NI0d/wBQ2lS2Ge2Cn7iL1Fq7u8kp3tWiPwfPx674njTjfS7dK7/q0eQ+C6Z43VquapX96Z0OTnNZjFNYFe16IJVT7UZbVen1Wj9RPcjs4TrjeyMi1+hjgfUzqAnJ2WK6qqv4PjbcjvJpltKTec91q7dJ7iLkk/6mfx3jE6uiuI86inVNFYRKyUh1p6Ix/Z3HFo2Z9pmr+Ynwf3HwZePAvsmxCivsZdx6XAZahKL+WlhBINlXstGi0Rl/8PgcfTanT6TLcoNv349UvPuelyafJmj0uVInp7JopOHVh42+l2sbYS0yf+JPaWjJReyt+S+Rkzu+RjWJ2FyvtNTDR+klXhTh8IL9zL/kcW6XY51AwHqiVE1EfmY/KWZyJJIP6dTZEfa7vwhwuCNPk/HJaMdO6oYjY5kdXAROai1bL/rTC2fqOexEnjXBGfn3P8CjNp8WPVLqncHvfp6+pnrXmx6aX6KudUvfj8clR01ze7tYV5X5A00xc17BSm0k12dzSm+4j7fwev8AcQ1azOr6R0PsMtW5F/ibC1pQomPsLTqUl9u+eDMZo3S+VU5jBuqm5flR/TWxYN2LyluOtKLt7UqIvjwR+DIhUL6YZqzTScQg5HWpxqQ+bhm4yfrpT3EfbrXyRH55P4G1/hTnaaSuL48X1L/vNHExR+IwgozUm0pLnluulv23VmHLsv6jU+LVmUNz6U4FgiOltr6UzdStbXcZn7a2Svf3IWN7lmf0Sq3GXlU0/JLh8zjOtNqSyyzoi2oj1tW+4/jRe4vuouByLzBKvGaaSwwUB5lSVSDPRobQpPsXnkZepGES8gkVVzS2SK69qj3GeWnubWXulRfr+vky1yMYajTS6FKMeZdv23Xbybvy+pi5VKXbv+6v6KSmy7MaHOImKZr/AA2WdkypcKZCQaSJREf2mXGy2WvBe3khW9MOr651Zdqy12Oh+AyqWyppv0/WaLg0EW+VErX+78C6oMEyWbl7GVZvcQpkyEypuDHhNmltszIy7jMyL5M9fPvxoVFP0UYcoqqJfTmjkwJ7j6lRkmaX2Vmk/SM1aMuS8+2z+Rk5aFprJV7W4rvvdfhMuhHUppq6358bc/k3uj/USyvqDJLrJVx2o9Y4S0k012em32KUaT55Pgi2Kvpr1Gyu+t5NRbJiRJNrXuTKFamO1HBqIiV57i4/7D+RnsOl+SLqcmrYNlWR2L62TJc5X9kcjM+zWvO+38aIJ3RqRWTae1xXIZap9bIQpsrR41tpaLyhPaX2l7a8aMxm3oH17pdXG3FJfy+TYhHLsn2/JXsZB1efzuThaLfGiso8QpKnTiq9I0mSeCPW9/cXsNKz6k5ejMrynXlWMUrVdI9Js7CMrTuvPaad71+deSHRoOHWDHWSbmqpMU4UmvKKTJGr1CURI58a19pjyFh0xzBvNL69q5WKvNWkk3Ut2UM3zbTvjW06I+edeQx59LKX1KK+ldu+19mbUMflnV8YcmvY9XvWMqLKluR0LdfjEZNOGZb7kEfOjFiK7GGLOLj8KPcORHJ7TRIeVFb7GjMv8qfYta4FiY4WT/Z0ZPkGAAMCDSfqat95Tz9ZCdcVypa46FKP9TMhstMMtMEw0y220RdpNpSRJIvjXgZDPQCXJvawkjFEjR4jCWIkdqOyn+620gkpL9CLgZQAQ3ZIAQJ2AAAAAAIEgAHAjYkAOAAAAD2AAAAAAAAACAABoAA/IABIAAAgAAAAAAAAAAEgAAAAAAIHvwAAAHuAB7AAAAAH+gAAAAAAAAAAAGAAAAAAAAAAAAAAAEAAAAAAAAAAAJAEAAAAAAAAAAAAAAAAAAAAAAAAAD//2QDNIQZWAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDI1LTEwLTIyVDEyOjU0OjI5KzAwOjAwI7wFewAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyNS0xMC0yMlQxMjo1NDoyOSswMDowMFLhvccAAAARdEVYdGV4aWY6Q29sb3JTcGFjZQAxD5sCSQAAABJ0RVh0ZXhpZjpFeGlmT2Zmc2V0ADU4++IZpQAAAB90RVh0ZXhpZjpFeGlmVmVyc2lvbgA0OCwgNTAsIDUwLCA0OBTTOW4AAAAzdEVYdGV4aWY6SW1hZ2VVbmlxdWVJRAA5ZTc5MTkxMTU5Njc2OTM2MDAwMDAwMDAwMDAwMDAwMHXNpHYAAAAfdEVYdGV4aWY6SW50ZXJvcGVyYWJpbGl0eU9mZnNldAAxNzD75lEbAAAAGXRFWHRleGlmOlBpeGVsWERpbWVuc2lvbgAxMDI08sVWHwAAABl0RVh0ZXhpZjpQaXhlbFlEaW1lbnNpb24AMTAyNEs+jfcAAAAUdEVYdGV4aWY6U29mdHdhcmUAUGljYXNhDcbnIwAAABx0RVh0ZXhpZjp0aHVtYm5haWw6Q29tcHJlc3Npb24ANvllcFcAAAAodEVYdGV4aWY6dGh1bWJuYWlsOkludGVyb3BlcmFiaWxpdHlJbmRleABSOThmv6aAAAAANXRFWHRleGlmOnRodW1ibmFpbDpJbnRlcm9wZXJhYmlsaXR5VmVyc2lvbgA0OCwgNDksIDQ4LCA0OFAh+qkAAAAodEVYdGV4aWY6dGh1bWJuYWlsOkpQRUdJbnRlcmNoYW5nZUZvcm1hdAAyOTR8Rx4WAAAAL3RFWHRleGlmOnRodW1ibmFpbDpKUEVHSW50ZXJjaGFuZ2VGb3JtYXRMZW5ndGgAMzEzObFdDEAAAAAfdEVYdGV4aWY6dGh1bWJuYWlsOlJlc29sdXRpb25Vbml0ADIlQF7TAAAAH3RFWHRleGlmOnRodW1ibmFpbDpYUmVzb2x1dGlvbgA3Mi8x2ocYLAAAAB90RVh0ZXhpZjp0aHVtYm5haWw6WVJlc29sdXRpb24ANzIvMXTvib0AAAAASUVORK5CYII="),
        // Please specify the base64 content of a 80x80 pixels image
        ExportMetadata("BigImageBase64", "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dGV4aWY6SW50ZXJvcGVyYWJpbGl0eU9mZnNldAAxNzD75lEbAAAAGXRFWHRleGlmOlBpeGVsWERpbWVuc2lvbgAxMDI08sVWHwAAABl0RVh0ZXhpZjpQaXhlbFlEaW1lbnNpb24AMTAyNEs+jfcAAAAUdEVYdGV4aWY6U29mdHdhcmUAUGljYXNhDcbnIwAAABx0RVh0ZXhpZjp0aHVtYm5haWw6Q29tcHJlc3Npb24ANvllcFcAAAAodEVYdGV4aWY6dGh1bWJuYWlsOkludGVyb3BlcmFiaWxpdHlJbmRleABSOThmv6aAAAAANXRFWHRleGlmOnRodW1ibmFpbDpJbnRlcm9wZXJhYmlsaXR5VmVyc2lvbgA0OCwgNDksIDQ4LCA0OFAh+qkAAAAodEVYdGV4aWY6dGh1bWJuYWlsOkpQRUdJbnRlcmNoYW5nZUZvcm1hdAAyOTR8Rx4WAAAAL3RFWHRleGlmOnRodW1ibmFpbDpKUEVHSW50ZXJjaGFuZ2VGb3JtYXRMZW5ndGgAMzEzObFdDEAAAAAfdEVYdGV4aWY6dGh1bWJuYWlsOlJlc29sdXRpb25Vbml0ADIlQF7TAAAAH3RFWHRleGlmOnRodW1ibmFpbDpYUmVzb2x1dGlvbgA3Mi8x2ocYLAAAAB90RVh0ZXhpZjp0aHVtYm5haWw6WVJlc29sdXRpb24ANzIvMXTvib0AAAAASUVORK5CYII="),
        ExportMetadata("BackgroundColor", "Lavender"),
        ExportMetadata("PrimaryFontColor", "Black"),
        ExportMetadata("SecondaryFontColor", "Gray")]
public class MyPlugin : PluginBase
    {
    public override IXrmToolBoxPluginControl GetControl()
    {
        return new MyPluginControl();
    }



        /// <summary>
        /// Constructor 
        /// </summary>
        public MyPlugin()
    {
        // If you have external assemblies that you need to load, uncomment the following to 
        // hook into the event that will fire when an Assembly fails to resolve
        // AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(AssemblyResolveEventHandler);
    }

    /// <summary>
    /// Event fired by CLR when an assembly reference fails to load
    /// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
    /// For example, a folder named Sample.XrmToolBox.MyPlugin 
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="args"></param>
    /// <returns></returns>
    private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
    {
        Assembly loadAssembly = null;
        Assembly currAssembly = Assembly.GetExecutingAssembly();

        // base name of the assembly that failed to resolve
        var argName = args.Name.Substring(0, args.Name.IndexOf(","));

        // check to see if the failing assembly is one that we reference.
        List<AssemblyName> refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
        var refAssembly = refAssemblies.Where(a => a.Name == argName).FirstOrDefault();

        // if the current unresolved assembly is referenced by our plugin, attempt to load
        if (refAssembly != null)
        {
            // load from the path to this plugin assembly, not host executable
            string dir = Path.GetDirectoryName(currAssembly.Location).ToLower();
            string folder = Path.GetFileNameWithoutExtension(currAssembly.Location);
            dir = Path.Combine(dir, folder);

            var assmbPath = Path.Combine(dir, $"{argName}.dll");

            if (File.Exists(assmbPath))
            {
                loadAssembly = Assembly.LoadFrom(assmbPath);
            }
            else
            {
                throw new FileNotFoundException($"Unable to locate dependency: {assmbPath}");
            }
        }

        return loadAssembly;
    }
}
}